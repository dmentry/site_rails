<%= form_with(model: article, local: true) do |form| %>
  <% if article.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(article.errors.count, "error") %> prohibited this article from being saved:</h2>

      <ul>
        <% article.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group mt-3">
    <%= form.label t('models.article.article_title_ru') %>
    <%= form.text_field :article_title_ru, class: 'form-control' %>
  </div>

  <div class="form-group">
    <%= form.label t('models.article.announce_ru') %>
    <%= form.text_area :announce_ru, size: '50x3', class: 'form-control' %>
  </div>

  <div class="form-group">
    <%= form.label t('models.article.article_body_ru') %>
    <%= form.text_area :article_body_ru, size: '50x12', class: 'form-control' %>
  </div>

  <div class="form-group mt-3">
    <%= form.label t('models.article.article_title_en') %>
    <%= form.text_field :article_title_en, class: 'form-control' %>
  </div>

  <div class="form-group">
    <%= form.label t('models.article.announce_en') %>
    <%= form.text_area :announce_en, size: '50x3', class: 'form-control' %>
  </div>

  <div class="form-group">
    <%= form.label t('models.article.article_body_en') %>
    <%= form.text_area :article_body_en, size: '50x12', class: 'form-control' %>
  </div>

  <div class="form-group mt-3">
    <%= form.label t('models.article.text_color') %>
    <%= form.text_field :text_color, class: 'form-control' %>
  </div>

  <div class="form-group mt-3">
    <%= form.label t('models.article.background_color') %>
    <%= form.text_field :background_color, class: 'form-control' %>
  </div>

  <div class="form-group">
    <%= form.label t('models.article.is_visible') %>
    <%= form.check_box :is_visible %>
  </div>

  <div class="form-group">
    <%= form.label :hashtag_names, "Хэштеги" %>

    <!-- Скрытое поле для хранения хэштегов -->
    <%#= form.hidden_field :hashtag_names, id: "entity_hashtag_names", value: article.hashtags.pluck(:name).join(','), class: "hashtags-hidden-input" %>

    <!-- Сделал его видимым для удобства копирования тэгов -->
    <div>Сюда вставлять теги через запятую</div>
    <%= form.text_area :hashtag_names, id: "entity_hashtag_names", value: article.hashtags.pluck(:name).join(','), class: "hashtags-hidden-input mb-2 form-control", size: '50x3' %>

    <!-- Поле для ввода новых хэштегов -->
    <input type="text" 
           id="hashtag-input" 
           class="form-control hashtags-input" 
           placeholder="Введите хэштег и нажмите Enter или запятую..." 
           autocomplete="off">

    <!-- Контейнер для отображения добавленных хэштегов -->
    <div id="hashtags-container" class="mt-2 d-flex flex-wrap hashtags-container">
      <% if article.hashtags.any? %>
        <% article.hashtags.order(:name).each do |hashtag| %>
          <span class="hashtag_badge hashtag-tag margin_r_2" data-tag-name="<%= hashtag.name %>">
            #<%= hashtag.name %> 
            <button type="button" class="btn-close btn-close-white ml-1 btn btn-light">❌</button>
          </span>
        <% end %>
      <% end %>
    </div>
    
    <div class="form-text">
      <small class="text-muted">
        • Начните вводить хэштег для автодополнения<br>
        • Нажмите Enter, запятую или Tab для добавления<br>
      </small>
    </div>
  </div>

  <div class="actions">
    <%= form.submit t('views.articles.form.save'), class: 'btn btn-sm btn-secondary mb-2' %>

    <%= link_to t('views.articles.new.back'), articles_path, class: 'btn btn-sm btn-primary mb-2' %>
  </div>
<% end %>
